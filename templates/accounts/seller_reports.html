{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rapport Vendeur - My Kanty</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/responsive.css' %}">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #F8F9FA; }
        .header { background: linear-gradient(135deg, #FF9933, #006B3F); color: white; padding: 15px 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        .navbar { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 800; color: white; text-decoration: none; }
        .nav-links a { color: white; text-decoration: none; padding: 8px 15px; border-radius: 5px; margin-left: 10px; }
        .nav-links a:hover { background: rgba(255,255,255,0.2); }
        .page-title { background: white; padding: 25px 0; border-bottom: 1px solid #D5D9D9; }
        .page-title h1 { color: #006B3F; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin: 30px 0; }
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; border-top: 4px solid #FF9933; transition: all 0.3s; }
        .stat-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .stat-card.green { border-top-color: #006B3F; }
        .stat-card.blue { border-top-color: #0066CC; }
        .stat-card.gold { border-top-color: #FFD700; }
        .stat-icon { font-size: 2.5rem; margin-bottom: 15px; }
        .stat-value { font-size: 2rem; font-weight: 800; color: #0F1111; margin-bottom: 5px; }
        .stat-label { color: #565959; font-size: 0.9rem; }
        .section-card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px; }
        .section-card h2 { color: #006B3F; margin-bottom: 20px; border-bottom: 2px solid #FFD700; padding-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .commission-summary { background: #FFF9CC; border: 2px solid #FF9933; padding: 25px; border-radius: 12px; margin-bottom: 25px; }
        .commission-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid #FFD700; font-size: 1.05rem; }
        .commission-row:last-child { border-bottom: none; font-size: 1.2rem; font-weight: 700; color: #006B3F; padding-top: 15px; }
        .commission-row.deduction { color: #C7511F; }
        table { width: 100%; border-collapse: collapse; }
        th { background: linear-gradient(135deg, #FF9933, #006B3F); color: white; padding: 12px 15px; text-align: left; font-size: 0.9rem; }
        td { padding: 12px 15px; border-bottom: 1px solid #D5D9D9; font-size: 0.9rem; color: #565959; }
        tr:nth-child(even) { background: #F8F9FA; }
        tr:hover { background: rgba(255,153,51,0.05); }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .status-released { background: #E8F5E9; color: #006B3F; }
        .status-pending { background: #FFF9CC; color: #B8860B; }
        .status-waiting { background: #F3E5F5; color: #7B1FA2; }
        .empty-row td { text-align: center; padding: 40px; color: #565959; }
        .print-btn { background: linear-gradient(135deg, #FF9933, #006B3F); color: white; padding: 12px 25px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s; }
        .print-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,153,51,0.4); }
        @media print {
            .header, .nav-links, .print-btn { display: none; }
            body { background: white; }
            .section-card { box-shadow: none; border: 1px solid #D5D9D9; }
        }
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .nav-links { display: none; }
            table { font-size: 0.8rem; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="{% url 'home' %}" class="logo"><i class="fas fa-shopping-bag"></i> My Kanty</a>
                <div class="nav-links">
                    <a href="{% url 'accounts:dashboard' %}"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                    <a href="{% url 'orders:seller-orders' %}"><i class="fas fa-store"></i> Mes Ventes</a>
                    <a href="{% url 'accounts:logout' %}"><i class="fas fa-sign-out-alt"></i> D√©connexion</a>
                </div>
            </nav>
        </div>
    </header>

    <div class="page-title">
        <div class="container" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
            <div>
                <h1><i class="fas fa-chart-bar"></i> Rapport de Ventes</h1>
                <p style="color: #565959; margin-top: 5px;">Bonjour {{ request.user.username }} üëã ‚Äî Voici votre r√©sum√© financier</p>
            </div>
            <button class="print-btn" onclick="window.print()">
                <i class="fas fa-print"></i> Imprimer le rapport
            </button>
        </div>
    </div>

    <div class="container" style="margin-top: 30px; padding-bottom: 60px;">

        <!-- Statistiques principales -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üì¶</div>
                <div class="stat-value">{{ stats.total_orders }}</div>
                <div class="stat-label">Commandes Re√ßues</div>
            </div>
            <div class="stat-card green">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-value">{{ stats.completed_orders }}</div>
                <div class="stat-label">Commandes Compl√©t√©es</div>
            </div>
            <div class="stat-card blue">
                <div class="stat-icon">üí∞</div>
                <div class="stat-value">{{ stats.total_sales|floatformat:0 }}</div>
                <div class="stat-label">Ventes Totales (XOF)</div>
            </div>
            <div class="stat-card gold">
                <div class="stat-icon">üè¶</div>
                <div class="stat-value">{{ stats.net_earnings|floatformat:0 }}</div>
                <div class="stat-label">Revenus Nets (XOF)</div>
            </div>
        </div>

        <!-- R√©sum√© financier -->
        <div class="commission-summary">
            <h3 style="color: #FF9933; margin-bottom: 20px;"><i class="fas fa-calculator"></i> R√©sum√© Financier</h3>
            <div class="commission-row">
                <span>üí∞ Total des ventes brutes</span>
                <span>{{ stats.total_sales|floatformat:0 }} XOF</span>
            </div>
            <div class="commission-row deduction">
                <span>üìä Commission My Kanty (5%)</span>
                <span>- {{ stats.total_commission|floatformat:0 }} XOF</span>
            </div>
            <div class="commission-row">
                <span>‚úÖ Revenus nets (re√ßus ou √† recevoir)</span>
                <span>{{ stats.net_earnings|floatformat:0 }} XOF</span>
            </div>
        </div>

        <!-- Commandes lib√©r√©es (pay√©es) -->
        <div class="section-card">
            <h2><i class="fas fa-check-circle" style="color: #006B3F;"></i> Paiements Re√ßus</h2>
            <table>
                <thead>
                    <tr>
                        <th>N¬∞ Commande</th>
                        <th>Client</th>
                        <th>Date</th>
                        <th>Montant Total</th>
                        <th>Commission (5%)</th>
                        <th>Vous avez re√ßu</th>
                        <th>Statut</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in released_orders %}
                    <tr>
                        <td><strong>{{ order.order_number }}</strong></td>
                        <td>{{ order.get_customer_name }}</td>
                        <td>{{ order.payment_released_at|date:"d/m/Y" }}</td>
                        <td>{{ order.total|floatformat:0 }} XOF</td>
                        <td style="color: #C7511F;">- {{ order.commission_amount|floatformat:0 }} XOF</td>
                        <td style="color: #006B3F; font-weight: 700;">{{ order.seller_amount|floatformat:0 }} XOF</td>
                        <td><span class="status-badge status-released">üí∏ Pay√©</span></td>
                    </tr>
                    {% empty %}
                    <tr class="empty-row">
                        <td colspan="7">
                            <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                            Aucun paiement re√ßu pour le moment
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Commandes en attente de paiement -->
        <div class="section-card">
            <h2><i class="fas fa-clock" style="color: #FF9933;"></i> Paiements en Attente</h2>
            <table>
                <thead>
                    <tr>
                        <th>N¬∞ Commande</th>
                        <th>Client</th>
                        <th>Date</th>
                        <th>Montant Total</th>
                        <th>Commission (5%)</th>
                        <th>Vous recevrez</th>
                        <th>Statut</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in pending_orders %}
                    <tr>
                        <td><strong>{{ order.order_number }}</strong></td>
                        <td>{{ order.get_customer_name }}</td>
                        <td>{{ order.created_at|date:"d/m/Y" }}</td>
                        <td>{{ order.total|floatformat:0 }} XOF</td>
                        <td style="color: #C7511F;">- {{ order.commission_amount|floatformat:0 }} XOF</td>
                        <td style="color: #006B3F; font-weight: 700;">{{ order.seller_amount|floatformat:0 }} XOF</td>
                        <td>
                            {% if order.is_delivery_confirmed %}
                            <span class="status-badge status-pending">‚è≥ Lib√©ration imminente</span>
                            {% elif order.status == 'delivered' %}
                            <span class="status-badge status-waiting">üì¶ Attente confirmation</span>
                            {% else %}
                            <span class="status-badge status-waiting">üöö En cours</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr class="empty-row">
                        <td colspan="7">
                            <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 10px; display: block; color: #006B3F;"></i>
                            Aucun paiement en attente
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Produits les plus vendus -->
        <div class="section-card">
            <h2><i class="fas fa-star" style="color: #FFD700;"></i> Vos Produits</h2>
            <table>
                <thead>
                    <tr>
                        <th>Produit</th>
                        <th>Quantit√© Vendue</th>
                        <th>Revenu Brut</th>
                        <th>Commission</th>
                        <th>Revenu Net</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in top_products %}
                    <tr>
                        <td><strong>{{ item.product_name }}</strong></td>
                        <td>{{ item.total_qty }}</td>
                        <td>{{ item.total_revenue|floatformat:0 }} XOF</td>
                        <td style="color: #C7511F;">- {{ item.commission|floatformat:0 }} XOF</td>
                        <td style="color: #006B3F; font-weight: 700;">{{ item.net_revenue|floatformat:0 }} XOF</td>
                    </tr>
                    {% empty %}
                    <tr class="empty-row">
                        <td colspan="5">Aucune vente enregistr√©e</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <footer style="background: linear-gradient(135deg, #006B3F, #FF9933); color: white; padding: 30px 0; text-align: center;">
        <p>&copy; 2026 My Kanty - Rapport g√©n√©r√© le {% now "d/m/Y √† H:i" %}</p>
    </footer>
</body>
</html>
 